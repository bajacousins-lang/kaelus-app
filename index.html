<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>BCNTV Premium</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --accent: #00ff88; --bg: #000; --card: #161616; }
        body { background: var(--bg); color: #fff; font-family: -apple-system, sans-serif; padding: 15px; margin: 0; }
        
        .search-box { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #333; background: #111; color: #fff; margin-bottom: 15px; box-sizing: border-box; font-size: 1rem; }
        
        .filter-bar { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: none; position: sticky; top: 0; background: var(--bg); z-index: 100; }
        .filter-bar::-webkit-scrollbar { display: none; }
        .pill { background: #222; border: 1px solid #444; color: #888; padding: 8px 16px; border-radius: 20px; white-space: nowrap; font-size: 0.8rem; font-weight: bold; cursor: pointer; }
        .pill.active { background: var(--accent); color: #000; border-color: var(--accent); }

        .card { background: var(--card); border-radius: 15px; padding: 12px; border: 1px solid #222; margin-bottom: 12px; display: flex; align-items: center; gap: 15px; }
        
        /* Contenedor del Logo con efecto Glow */
        .logo-container { width: 55px; height: 55px; flex-shrink: 0; background: #222; border-radius: 12px; }
        .logo-img { 
            width: 100%; height: 100%; border-radius: 12px; object-fit: cover; 
            border: 2px solid var(--accent); box-shadow: 0 0 10px rgba(0, 255, 136, 0.4); 
        }

        .info { flex-grow: 1; overflow: hidden; }
        .cat-tag { font-size: 0.65rem; color: var(--accent); font-weight: bold; text-transform: uppercase; }
        .title { font-weight: bold; font-size: 1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        .btn-play { background: var(--accent); color: #000; border: none; padding: 10px 18px; border-radius: 10px; font-weight: 800; cursor: pointer; }
        
        #loader { text-align: center; margin-top: 35vh; color: var(--accent); }
    </style>
</head>
<body>

    <input type="text" id="search" class="search-box" placeholder="ðŸ” Buscar canal...">

    <div class="filter-bar">
        <div class="pill active" onclick="filterData('TODOS', this)">ðŸš€ TODOS</div>
        <div class="pill" onclick="filterData('âš½ DEPORTES', this)">âš½ DEPORTES</div>
        <div class="pill" onclick="filterData('ðŸŽ¬ CINE', this)">ðŸŽ¬ CINE</div>
        <div class="pill" onclick="filterData('ðŸ“º TV LIVE', this)">ðŸ“º TV</div>
    </div>

    <div id="loader"><p>Cargando BCNTV...</p></div>
    <div id="container"></div>

    <script>
        const tg = window.Telegram.WebApp;
        const API_URL = "https://kaelus-bot.onrender.com"; 
        const MI_LOGO = "logo.png"; // Se carga desde tu GitHub

        async function initApp() {
            try {
                const res = await fetch(`${API_URL}/api/links`);
                const items = await res.json();
                if (items.length > 0) {
                    render(items);
                    document.getElementById('loader').style.display = 'none';
                } else {
                    throw new Error();
                }
            } catch (e) {
                setTimeout(initApp, 4000);
            }
        }

        function render(items) {
            const container = document.getElementById('container');
            container.innerHTML = items.map(i => `
                <div class="card item-card" data-cat="${i.cat}" data-name="${i.t}">
                    <div class="logo-container">
                        <img src="${MI_LOGO}" class="logo-img" loading="lazy">
                    </div>
                    <div class="info">
                        <div class="cat-tag">${i.cat}</div>
                        <div class="title">${i.t}</div>
                    </div>
                    <button class="btn-play" onclick="tg.openLink('${i.u}')">VER</button>
                </div>
            `).join('');
        }

        function filterData(cat, el) {
            document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
            el.classList.add('active');
            document.querySelectorAll('.item-card').forEach(card => {
                const itemCat = card.getAttribute('data-cat');
                card.style.display = (cat === 'TODOS' || itemCat === cat) ? 'flex' : 'none';
            });
            tg.HapticFeedback.impactOccurred('light');
        }

        document.getElementById('search').addEventListener('input', (e) => {
            const t = e.target.value.toLowerCase();
            document.querySelectorAll('.item-card').forEach(c => {
                c.style.display = c.getAttribute('data-name').toLowerCase().includes(t) ? 'flex' : 'none';
            });
        });

        tg.ready();
        tg.expand();
        initApp();
    </script>
</body>
</html>
