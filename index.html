<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kaelus Experience</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg:#0a0a0a; --card:#161616; --accent-sport:#00ff88; --accent-movie:#ff3e3e; --accent-series:#00e1ff; --text-main:#fff; --text-dim:#888; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text-main); margin: 0; }
        .header-container { position: sticky; top: 0; background: rgba(10,10,10,0.9); padding: 15px; border-bottom: 1px solid #222; z-index: 10; }
        #buscador { width: 100%; background: #1e1e1e; border: 1px solid #333; border-radius: 10px; padding: 10px; color: white; box-sizing: border-box; }
        .filter-group { display: flex; gap: 10px; padding: 10px 0; overflow-x: auto; }
        .f-btn { background: #222; color: #888; border: none; padding: 8px 15px; border-radius: 20px; white-space: nowrap; }
        .f-btn.active { background: white; color: black; }
        #main-container { padding: 15px; }
        .card { background: var(--card); border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid #252525; }
        .tag { font-size: 10px; font-weight: bold; padding: 3px 8px; border-radius: 5px; text-transform: uppercase; margin-bottom: 8px; display: inline-block; }
        .tag-deporte { background: rgba(0,255,136,0.1); color: var(--accent-sport); }
        .tag-pelicula { background: rgba(255,62,62,0.1); color: var(--accent-movie); }
        .tag-serie { background: rgba(0,225,255,0.1); color: var(--accent-series); }
        .title { font-size: 16px; font-weight: bold; }
        .skeleton { height: 80px; background: #161616; border-radius: 15px; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="header-container">
        <input id="buscador" placeholder="Buscar contenido..." onkeyup="render()">
        <div class="filter-group">
            <button class="f-btn active" onclick="setFiltro('todos',this)">Todos</button>
            <button class="f-btn" onclick="setFiltro('deporte',this)">Deportes</button>
            <button class="f-btn" onclick="setFiltro('pelicula',this)">Películas</button>
            <button class="f-btn" onclick="setFiltro('serie',this)">Series</button>
        </div>
    </div>

    <div id="main-container">
        <div class="skeleton"></div>
        <div class="skeleton"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // DIRECCIÓN CORRECTA: Apunta a /api/data del bot
        const API_URL = "https://kaelus-bot.onrender.com/api/data";

        let fullData = [];
        let currentFiltro = "todos";

        async function cargarDatos() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                
                fullData = [
                    ...(data.deportes || []).map(t => ({tipo: "deporte", titulo: t})),
                    ...(data.peliculas || []).map(t => ({tipo: "pelicula", titulo: t})),
                    ...(data.series || []).map(t => ({tipo: "serie", titulo: t}))
                ];
                render();
            } catch (e) {
                document.getElementById("main-container").innerHTML = "<p style='color:gray;text-align:center;'>Error al conectar con el bot.</p>";
            }
        }

        function setFiltro(tipo, btn) {
            currentFiltro = tipo;
            document.querySelectorAll(".f-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            render();
        }

        function render() {
            const container = document.getElementById("main-container");
            const busqueda = document.getElementById("buscador").value.toLowerCase();
            container.innerHTML = "";

            const filtrados = fullData.filter(i => 
                i.titulo.toLowerCase().includes(busqueda) && 
                (currentFiltro === "todos" || i.tipo === currentFiltro)
            );

            if (filtrados.length === 0) {
                container.innerHTML = "<p style='text-align:center; color:gray;'>No se encontró contenido.</p>";
                return;
            }

            filtrados.forEach(i => {
                const div = document.createElement("div");
                div.className = "card";
                div.innerHTML = `
                    <div class="tag tag-${i.tipo}">${i.tipo}</div>
                    <div class="title">${i.titulo}</div>
                `;
                container.appendChild(div);
            });
        }

        cargarDatos();
    </script>
</body>
</html>
