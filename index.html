<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>BCNTV Premium</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --accent: #00ff88; --bg: #000; --card: #121212; }
        body { background: var(--bg); color: #fff; font-family: -apple-system, sans-serif; padding: 15px; margin: 0; }
        .search-box { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #333; background: #1a1a1a; color: #fff; margin-bottom: 15px; box-sizing: border-box; outline: none; }
        .filter-bar { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: none; position: sticky; top: 0; background: var(--bg); z-index: 10; }
        .pill { background: #222; border: 1px solid #333; color: #888; padding: 8px 16px; border-radius: 20px; white-space: nowrap; font-size: 12px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .pill.active { background: var(--accent); color: #000; border-color: var(--accent); }
        .card { background: var(--card); border-radius: 12px; padding: 12px; border: 1px solid #222; margin-bottom: 10px; display: flex; align-items: center; gap: 12px; }
        .logo-container { width: 55px; height: 75px; flex-shrink: 0; border-radius: 8px; border: 1px solid #333; overflow: hidden; background: #111; }
        .logo-img { width: 100%; height: 100%; object-fit: cover; }
        .info { flex-grow: 1; min-width: 0; }
        .cat-tag { font-size: 9px; color: var(--accent); font-weight: bold; text-transform: uppercase; }
        .title { font-weight: bold; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #eee; }
        .actions { display: flex; align-items: center; gap: 10px; }
        .btn-play { background: var(--accent); color: #000; border: none; padding: 8px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-fav { background: none; border: none; font-size: 20px; cursor: pointer; color: #444; }
        .btn-fav.active { color: #ffeb3b; }
        #loader { text-align: center; margin-top: 35vh; color: var(--accent); font-weight: bold; }
    </style>
</head>
<body>
    <input type="text" id="search" class="search-box" placeholder="üîç Buscar canal o pel√≠cula...">
    <div class="filter-bar">
        <div class="pill active" onclick="filterData('TODOS', this)">üöÄ TODO</div>
        <div class="pill" onclick="filterData('‚≠ê FAVORITOS', this)">‚≠ê FAVS</div>
        <div class="pill" onclick="filterData('‚öΩ DEPORTES', this)">‚öΩ DEPORTES</div>
        <div class="pill" onclick="filterData('üé¨ CINE', this)">üé¨ CINE</div>
        <div class="pill" onclick="filterData('üì∫ SERIES', this)">üì∫ SERIES</div>
    </div>
    <div id="loader">üõ∞Ô∏è Sincronizando Kaelus...</div>
    <div id="container"></div>

    <script>
        const tg = window.Telegram.WebApp;
        const API_URL = "https://tu-app-en-render.onrender.com"; 
        let allItems = [];
        let currentFilter = 'TODOS';
        let currentSearch = '';

        async function init() {
            try {
                const res = await fetch(`${API_URL}/api/links`);
                allItems = await res.json();
                render();
                document.getElementById('loader').style.display = 'none';
            } catch (e) { setTimeout(init, 4000); }
        }

        function render() {
            const container = document.getElementById('container');
            const favs = JSON.parse(localStorage.getItem('bcntv_favs') || '[]');
            let filtered = allItems;

            if (currentFilter === '‚≠ê FAVORITOS') filtered = filtered.filter(i => favs.includes(i.u));
            else if (currentFilter !== 'TODOS') filtered = filtered.filter(i => i.cat === currentFilter);
            
            if (currentSearch) filtered = filtered.filter(i => i.t.toLowerCase().includes(currentSearch));

            container.innerHTML = filtered.map(i => `
                <div class="card">
                    <div class="logo-container"><img src="${i.img}" class="logo-img" onerror="this.src='logo.png'"></div>
                    <div class="info">
                        <div class="cat-tag">${i.cat}</div>
                        <div class="title">${i.t}</div>
                    </div>
                    <div class="actions">
                        <button class="btn-fav ${favs.includes(i.u) ? 'active' : ''}" onclick="toggleFav('${i.u}')">‚òÖ</button>
                        <button class="btn-play" onclick="tg.openLink('${i.u}')">VER</button>
                    </div>
                </div>
            `).join('');
        }

        function toggleFav(url) {
            let favs = JSON.parse(localStorage.getItem('bcntv_favs') || '[]');
            if (favs.includes(url)) favs = favs.filter(f => f !== url);
            else favs.push(url);
            localStorage.setItem('bcntv_favs', JSON.stringify(favs));
            tg.HapticFeedback.impactOccurred('light');
            render();
        }

        function filterData(cat, el) {
            tg.HapticFeedback.selectionChanged();
            document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
            el.classList.add('active');
            currentFilter = cat;
            render();
        }

        document.getElementById('search').addEventListener('input', (e) => {
            currentSearch = e.target.value.toLowerCase();
            render();
        });

        tg.ready();
        tg.expand();
        init();
    </script>
</body>
</html>
